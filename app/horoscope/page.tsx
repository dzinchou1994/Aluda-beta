'use client';

import React, { useState } from 'react';
import { motion } from 'framer-motion';

// ზოდიაქოს ნიშნები
const zodiacSigns = [
  { name: 'ვერძი', emoji: '♈', dates: '21 მარტი - 19 აპრილი', element: 'ცეცხლი' },
  { name: 'კურო', emoji: '♉', dates: '20 აპრილი - 20 მაისი', element: 'მიწა' },
  { name: 'ტყუპები', emoji: '♊', dates: '21 მაისი - 20 ივნისი', element: 'ჰაერი' },
  { name: 'კირჩხიბი', emoji: '♋', dates: '21 ივნისი - 22 ივლისი', element: 'წყალი' },
  { name: 'ლომი', emoji: '♌', dates: '23 ივლისი - 22 აგვისტო', element: 'ცეცხლი' },
  { name: 'ქალწული', emoji: '♍', dates: '23 აგვისტო - 22 სექტემბერი', element: 'მიწა' },
  { name: 'სასწორი', emoji: '♎', dates: '23 სექტემბერი - 22 ოქტომბერი', element: 'ჰაერი' },
  { name: 'მორიელი', emoji: '♏', dates: '23 ოქტომბერი - 21 ნოემბერი', element: 'წყალი' },
  { name: 'მშვილდოსანი', emoji: '♐', dates: '22 ნოემბერი - 21 დეკემბერი', element: 'ცეცხლი' },
  { name: 'თხის რქა', emoji: '♑', dates: '22 დეკემბერი - 19 იანვარი', element: 'მიწა' },
  { name: 'მერწყული', emoji: '♒', dates: '20 იანვარი - 18 თებერვალი', element: 'ჰაერი' },
  { name: 'თევზები', emoji: '♓', dates: '19 თებერვალი - 20 მარტი', element: 'წყალი' }
];

// დამატებითი მეტა ინფორმაცია ნიშნებისთვის (მოდალობა, მმართველი პლანეტა)
const signMeta: Record<string, { modality: string; ruler: string }> = {
  'ვერძი': { modality: 'კარდინალური', ruler: 'მარსი' },
  'კურო': { modality: 'ფიქსირებული', ruler: 'ვენერა' },
  'ტყუპები': { modality: 'მუტაბელური', ruler: 'მერკური' },
  'კირჩხიბი': { modality: 'კარდინალური', ruler: 'მთვარე' },
  'ლომი': { modality: 'ფიქსირებული', ruler: 'მზე' },
  'ქალწული': { modality: 'მუტაბელური', ruler: 'მერკური' },
  'სასწორი': { modality: 'კარდინალური', ruler: 'ვენერა' },
  'მორიელი': { modality: 'ფიქსირებული', ruler: 'პლუტონი (ტრად. მარსი)' },
  'მშვილდოსანი': { modality: 'მუტაბელური', ruler: 'იუპიტერი' },
  'თხის რქა': { modality: 'კარდინალური', ruler: 'შავი (სატურნი)' },
  'მერწყული': { modality: 'ფიქსირებული', ruler: 'ურანი (ტრად. სატურნი)' },
  'თევზები': { modality: 'მუტაბელური', ruler: 'ნეპტუნი (ტრად. იუპიტერი)' }
};

// ყოველდღიური ჰოროსკოპების ბაზა
const horoscopeBase = {
  'ვერძი': [
    '🌟 დღეს ვერძის ნიშნისთვის ძალიან კარგი დღეა! ახალი იდეები და პროექტები წარმატებით განხორციელდება. ყურადღება მიაქციეთ ჯანმრთელობას.',
    '🔥 დღეს ვერძისთვის ენერგია ძალიან მაღალია! ახალი გამოწვევები მოგივლით და წარმატებას მიაღწევთ.',
    '⚡ ვერძისთვის დღეს ცვლილებების დროა! არ ეშინოთ ახალი საქმეების დაწყებისა.',
    '💪 დღეს ვერძისთვის ძლიერი ხასიათი გამოიჩინეთ! ყველაფერი შესაძლებელია თუ ღირსეულად იბრძვით.',
    '🚀 დღეს ვერძისთვის ახალი მიზნები და ამბიციები მნიშვნელოვანია. ყველაფერი შესაძლებელია!',
    '⭐ ვერძისთვის დღეს ლიდერობის უნარი გამოიჩინეთ. ახალი პროექტები დაიწყეთ.',
    '🎯 დღეს ვერძისთვის მიზანდასახულობა და ენერგია მნიშვნელოვანია. წარმატება ხელშია!',
    '💎 ვერძისთვის დღეს კრეატიულობა და ინოვაცია მნიშვნელოვანია. ახალი იდეები შეიძლება.',
    '🌈 დღეს ვერძისთვის ოპტიმიზმი და პოზიტიური ენერგია მნიშვნელოვანია. ყველაფერი კარგად იქნება!',
    '🎪 ვერძისთვის დღეს სოციალური ურთიერთობები და კომუნიკაცია მნიშვნელოვანია.',
    '🏆 დღეს ვერძისთვის კონკურენტუნარიანობა და ამბიცია მნიშვნელოვანია. წარმატება ხელშია!',
    '🎨 ვერძისთვის დღეს კრეატიულობა და ხელოვნება მნიშვნელოვანია. ახალი პროექტები დაიწყეთ.',
    '💫 დღეს ვერძისთვის ინტუიცია და ინსპირაცია მნიშვნელოვანია. ახალი იდეები შეიძლება.',
    '🌟 ვერძისთვის დღეს ყველაფერი ხელშია! ახალი შესაძლებლობები და გამოწვევები მოგივლით.',
    '🔥 დღეს ვერძისთვის ენერგია და მოტივაცია მაღალია. ახალი მიზნები დაიწყეთ!'
  ],
  'კურო': [
    '💎 კუროს ნიშნისთვის დღეს ფინანსური კითხვები მნიშვნელოვანია. მოძებნეთ ახალი შესაძლებლობები და იყავით მომთმენი.',
    '🏠 დღეს კუროსთვის სახლი და ოჯახი პრიორიტეტია. მომთმენობა და სტაბილურობა მნიშვნელოვანია.',
    '💰 კუროსთვის დღეს ფინანსური გეგმები მნიშვნელოვანია. ფრთხილად იყავით და ფიქრობდეთ მომავალზე.',
    '🌱 დღეს კუროსთვის ნელი, მაგრამ მტკიცე ნაბიჯები გადადგით. მომთმენობა წარმატების გასაღებია.',
    '🍀 კუროსთვის დღეს იღბალი და წარმატება მოგივლით. ახალი შესაძლებლობები შეიძლება.',
    '🌿 დღეს კუროსთვის ბუნება და ჰარმონია მნიშვნელოვანია. სტაბილურობა და მომთმენობა.',
    '💎 კუროსთვის დღეს ფინანსური სტაბილურობა და უსაფრთხოება მნიშვნელოვანია.',
    '🏡 დღეს კუროსთვის სახლი და ოჯახი პრიორიტეტია. ლამაზი გარემო შეიქმნება.',
    '🌾 კუროსთვის დღეს მუშაობა და კარიერა მნიშვნელოვანია. მომთმენობა და ორგანიზებულობა.',
    '💚 დღეს კუროსთვის ჯანმრთელობა და ბალანსი მნიშვნელოვანია. ბუნებრივი რიტმი.',
    '🌳 კუროსთვის დღეს ბუნება და ეკოლოგია მნიშვნელოვანია. მშვიდობა და ჰარმონია.',
    '💎 დღეს კუროსთვის ფინანსური ინვესტიციები და გეგმები მნიშვნელოვანია.',
    '🏠 კუროსთვის დღეს სახლი და ოჯახი პრიორიტეტია. სტაბილურობა და უსაფრთხოება.',
    '🌱 დღეს კუროსთვის ნელი, მაგრამ მტკიცე ნაბიჯები გადადგით. მომთმენობა წარმატების გასაღებია.',
    '💎 კუროსთვის დღეს ფინანსური სტაბილურობა და უსაფრთხოება მნიშვნელოვანია.'
  ],
  'ტყუპები': [
    '💬 ტყუპების ნიშნისთვის კომუნიკაცია ძალიან მნიშვნელოვანია დღეს. ახალი კონტაქტები და მეგობრობები შეიძლება.',
    '📚 დღეს ტყუპებისთვის სწავლა და ცოდნა მნიშვნელოვანია. ახალი ინფორმაცია მოგივლით.',
    '🗣️ ტყუპებისთვის დღეს კომუნიკაციის ძალა გამოიჩინეთ! ახალი კონტაქტები და იდეები შეიძლება.',
    '🎭 დღეს ტყუპებისთვის კრეატიულობა და მრავალმხრივობა მნიშვნელოვანია. ახალი პროექტები დაიწყეთ.'
  ],
  'კირჩხიბი': [
    '🏠 კირჩხიბის ნიშნისთვის ოჯახი და სახლი პრიორიტეტია. ემოციური ბალანსი მნიშვნელოვანია.',
    '❤️ დღეს კირჩხიბისთვის ემოციები და ურთიერთობები მნიშვნელოვანია. ოჯახთან დრო გაატარეთ.',
    '🌙 კირჩხიბისთვის დღეს ინტუიცია ძალიან ძლიერია. ემოციურ ბალანსზე ფოკუსირება.',
    '🦀 დღეს კირჩხიბისთვის უსაფრთხოება და სტაბილურობა მნიშვნელოვანია. სახლში დრო გაატარეთ.'
  ],
  'ლომი': [
    '👑 ლომის ნიშნისთვის დღეს ყველაფერი ხელშია! კრეატიულობა და ლიდერობა გამოიჩინეთ.',
    '🎭 დღეს ლომისთვის კრეატიულობა და თავდაჯერებულობა მნიშვნელოვანია. ახალი პროექტები დაიწყეთ.',
    '🌟 ლომისთვის დღეს ყველაფერი ხელშია! ლიდერობის უნარი გამოიჩინეთ და ახალი გამოწვევები მიიღეთ.',
    '🎪 დღეს ლომისთვის ყურადღების ცენტრში ყოფნა მნიშვნელოვანია. კრეატიულობა და თავდაჯერებულობა.'
  ],
  'ქალწული': [
    '🔍 ქალწულის ნიშნისთვის დეტალებზე ყურადღება მიაქციეთ. ორგანიზებულობა წარმატების გასაღებია.',
    '📋 დღეს ქალწულისთვის ორგანიზებულობა და დეტალებზე ფოკუსირება მნიშვნელოვანია. ყველაფერი სისტემატურად.',
    '⚕️ ქალწულისთვის დღეს ჯანმრთელობა და ორგანიზებულობა მნიშვნელოვანია. ყურადღება მიაქციეთ დეტალებს.',
    '🎯 დღეს ქალწულისთვის მიზანდასახულობა და ორგანიზებულობა მნიშვნელოვანია. ყველაფერი სისტემატურად.'
  ],
  'სასწორი': [
    '⚖️ სასწორის ნიშნისთვის ჰარმონია და ბალანსი მნიშვნელოვანია. კონფლიქტების თავიდან აცილება.',
    '🤝 დღეს სასწორისთვის ურთიერთობები და ჰარმონია მნიშვნელოვანია. ბალანსი შეინარჩუნეთ.',
    '💕 სასწორისთვის დღეს სიყვარული და ჰარმონია მნიშვნელოვანია. ურთიერთობებში ბალანსი.',
    '🎨 დღეს სასწორისთვის კრეატიულობა და ესთეტიკა მნიშვნელოვანია. ჰარმონია და ბალანსი.'
  ],
  'მორიელი': [
    '🦂 მორიელის ნიშნისთვის ღრმა ანალიზი და ინტუიცია მნიშვნელოვანია. ტრანსფორმაციის დროა.',
    '🔮 დღეს მორიელისთვის ინტუიცია და ღრმა ანალიზი მნიშვნელოვანია. ტრანსფორმაცია და ცვლილება.',
    '💎 მორიელისთვის დღეს ღრმა ემოციები და ინტუიცია მნიშვნელოვანია. ტრანსფორმაციის დროა.',
    '🌊 დღეს მორიელისთვის ღრმა ანალიზი და ინტუიცია მნიშვნელოვანია. ცვლილებები და ტრანსფორმაცია.'
  ],
  'მშვილდოსანი': [
    '🏹 მშვილდოსნის ნიშნისთვის ახალი მიზნები და მოგზაურობა შეიძლება. ფილოსოფიური აზროვნება.',
    '🌍 დღეს მშვილდოსნისთვის მოგზაურობა და ახალი გამოცდილებები მნიშვნელოვანია. ოპტიმიზმი.',
    '📚 მშვილდოსნისთვის დღეს სწავლა და ფილოსოფია მნიშვნელოვანია. ახალი იდეები და მიზნები.',
    '🎯 დღეს მშვილდოსნისთვის ახალი მიზნები და ადვენტურა მნიშვნელოვანია. ოპტიმიზმი და ენერგია.'
  ],
  'თხის რქა': [
    '🐐 თხის რქის ნიშნისთვის მუშაობა და კარიერა პრიორიტეტია. მიზანდასახულობა და მოთმენა.',
    '💼 დღეს თხის რქისთვის კარიერა და მიზანდასახულობა მნიშვნელოვანია. მოთმენა და ორგანიზებულობა.',
    '🏔️ თხის რქისთვის დღეს მიზანდასახულობა და მოთმენა მნიშვნელოვანია. კარიერა და წარმატება.',
    '⚡ დღეს თხის რქისთვის მუშაობა და კარიერა მნიშვნელოვანია. მიზანდასახულობა და მოთმენა.'
  ],
  'მერწყული': [
    '🌊 მერწყულის ნიშნისთვის ინოვაცია და ცვლილება მნიშვნელოვანია. ორიგინალური იდეები.',
    '💡 დღეს მერწყულისთვის ინოვაცია და ორიგინალური იდეები მნიშვნელოვანია. ცვლილებები და პროგრესი.',
    '🚀 მერწყულისთვის დღეს ტექნოლოგია და ინოვაცია მნიშვნელოვანია. ორიგინალური მიდგომები.',
    '⚡ დღეს მერწყულისთვის ინოვაცია და ცვლილება მნიშვნელოვანია. ორიგინალური იდეები და პროგრესი.'
  ],
  'თევზები': [
    '🐠 თევზების ნიშნისთვის ინტუიცია და ემპათია ძალიან ძლიერია. კრეატიულობა და ხელოვნება.',
    '🎨 დღეს თევზებისთვის კრეატიულობა და ხელოვნება მნიშვნელოვანია. ინტუიცია და ემპათია.',
    '🌊 თევზებისთვის დღეს ემოციები და ინტუიცია მნიშვნელოვანია. კრეატიულობა და ხელოვნება.',
    '💫 დღეს თევზებისთვის ინტუიცია და ემპათია ძალიან ძლიერია. კრეატიულობა და ხელოვნება.'
  ]
};

// ზოდიაქოს ნიშნების ინგლისური სახელები API-სთვის
const signNames = {
  'ვერძი': 'aries',
  'კურო': 'taurus', 
  'ტყუპები': 'gemini',
  'კირჩხიბი': 'cancer',
  'ლომი': 'leo',
  'ქალწული': 'virgo',
  'სასწორი': 'libra',
  'მორიელი': 'scorpio',
  'მშვილდოსანი': 'sagittarius',
  'თხის რქა': 'capricorn',
  'მერწყული': 'aquarius',
  'თევზები': 'pisces'
};

// ყოველდღიური ჰოროსკოპის მიღება API-დან
const getDailyHoroscope = async (sign: string) => {
  try {
    const englishSign = signNames[sign as keyof typeof signNames];
    if (!englishSign) return 'ჰოროსკოპი ვერ მოიძებნა.';
    
    const response = await fetch(`https://any.ge/horoscope/api/?sign=${englishSign}&type=daily&day=today&lang=ge`);
    const data = await response.json();
    
    if (data && data.horoscope) {
      return data.horoscope;
    }
    
    // თუ API არ მუშაობს, ვიყენებთ ლოკალურ ბაზას
    const today = new Date();
    const dayOfYear = Math.floor((today.getTime() - new Date(today.getFullYear(), 0, 0).getTime()) / (1000 * 60 * 60 * 24));
    const horoscopes = horoscopeBase[sign as keyof typeof horoscopeBase];
    if (!horoscopes) return 'ჰოროსკოპი ვერ მოიძებნა.';
    
    const index = dayOfYear % horoscopes.length;
    return horoscopes[index];
  } catch (error) {
    console.error('API Error:', error);
    // თუ API არ მუშაობს, ვიყენებთ ლოკალურ ბაზას
    const today = new Date();
    const dayOfYear = Math.floor((today.getTime() - new Date(today.getFullYear(), 0, 0).getTime()) / (1000 * 60 * 60 * 24));
    const horoscopes = horoscopeBase[sign as keyof typeof horoscopeBase];
    if (!horoscopes) return 'ჰოროსკოპი ვერ მოიძებნა.';
    
    const index = dayOfYear % horoscopes.length;
    return horoscopes[index];
  }
};

// ზოგადი ნიშნების აღწერა
const signDescriptions = {
  'ვერძი': {
    male: '🔥 მიმოხილვა: ვერძი მამაკაცი — კარდინალური ცეცხლი მარსის მმართველობით. სწრაფი სტარტი, სითამამე და ინიციატივა მისი სავიზიტო ბარათია. გადაწყვეტილებებს იღებს ოპერატიულად და ხშირად ხდება გუნდის ამძრავი.\n\nკარიერა: წარმატებულია სტარტაპებში, გაყიდვებში, სპორტში, უსაფრთხოებასა და ოპერაციულ მართვაში — სადაც საჭიროა სწრაფი რეაქცია და ლიდერობა. ეფექტური ხდება პროექტების საწყის ფაზაში.\n\nხასიათი: უშუალო, პირდაპირი და ენერგიული. ადვილად იღებს რისკებს და ხშირად ამარცხებს ინერტულობას.\n\nურთიერთობები: აფასებს გულწრფელობასა და აქტიურობას. სჭირდება პარტნიორი, ვინც მის დინამიკას გაუძლებს, ხოლო ურთიერთობაში პატივისცემა და თავისუფლება პრიორიტეტია.\n\nჯანმრთელობა: ენერგიის მაღალი დონე მოითხოვს სტაბილურ ძილსა და ფიზიკურ აქტივობას. სასარგებლოა სპორტი და სუნთქვითი პრაქტიკები.\n\nსიძლიერეები: მამაცობა, სწრაფი მოქმედება, მოტივაცია სხვებისთვის.\n\nსუსტი მხარეები: მოუთმენლობა და იმპულსურობა.\n\nრჩევა: სტრატეგიული პაუზები და წინასწარი გეგმვა ენერგიას სწორად არხავდება.',
    female: '🔥 მიმოხილვა: ვერძი ქალი — ძლიერი ინდივიდუალიზმი და ქარიზმა. მისი ყოფნა ააქტიურებს სივრცეს და უბიძგებს გუნდს პროგრესისკენ. არ ეშინია თამამი გადაწყვეტილებების მიღებას და ახლის დაწყებას.\n\nკარიერა: ბრწყინავს როლებში, სადაც ინიციატივა და საჯაროობაა საჭირო — პროდუქტის მენეჯმენტი, მარკეტინგი, მედია/სცენა, პროექტების ლიდერობა.\n\nხასიათი: ვნებიანი, პირდაპირი და მიზანდასახული. სწრაფად განსაზღვრავს პრიორიტეტებს და არღვევს სტაგნაციას.\n\nურთიერთობები: სჭირდება სივრცე, პატივისცემა და თანასწორი პარტნიორობა. მისთვის მნიშვნელოვანია ემოციური სიმართლე და დინამიკა.\n\nჯანმრთელობა: აქტიური ცხოვრების სტილი ეხმარება სტრესის მართვაში. აუცილებელია რეგულარული დასვენება.\n\nსიძლიერეები: ინიციატივა, ლიდერობა, შთაგონება.\n\nსუსტი მხარეები: მწვავე რეაქციები, სწრაფი გადაღლა.\n\nრჩევა: ემოციურ ინტელექტზე მუშაობა და დოზირებული პაუზები ბალანსს ქმნის.'
  },
  'კურო': {
    male: '💎 მიმოხილვა: კურო მამაკაცი — ფიქსირებული მიწა ვენერას მმართველობით. პრაგმატული, გემოვნებიანი და მდგრადი. სტაბილური ზრდის სტრატეგია მისი სტილია.\n\ნკარიერა: ძლიერი მიმართულებებია ფინანსები, ფუნდამენტური ბიზნესები, უძრავი ქონება, მიწათმოქმედება, დიზაინი და კულინარია. ბრწყინავს那里, სადაც ხარისხი და გამძლეობა ფასობს.\n\nხასიათი: მშვიდი ძალა, მაღალი სტანდარტები და სენსორული ესთეტიკა.\n\nურთიერთობები: სანდო, თბილი და ერთგულია. აფასებს კომფორტს, სიმშვიდეს და ყოველდღიურ რიტუალებს.\n\nჯანმრთელობა: რუტინა სასარგებლოა, თუმცა საჭიროა მოქნილობის დოზა; რეკომენდებულია ზომიერი სპორტი.\n\nსიძლიერეები: სიღრმე, მოთმინება, ფინანსური ინსტინქტი.\n\nსუსტი მხარეები: ცვლილებების მიმართ რეზისტენტულობა, ჯიუტობა.\n\nრჩევა: მცირე, გეგმიური სიახლეები ზრდის მოქნილობასა და ბედნიერებას.',
    female: '💎 მიმოხილვა: კურო ქალი — დახვეწილი გემოვნება და პრაქტიკული ინტელექტი. მისთვის მნიშვნელოვანია ემოციური და მატერიალური უსაფრთხოება, სტაბილური გარემო და ხარისხი.\n\nკარიერა: დიზაინი, ფეშენი, ბიუჯეტირება, პარტნიორული სერვისები, რესტორანი/ჰოსპიტალითი — სფეროები, სადაც სტანდარტი და სილამაზე საჭიროა.\n\nხასიათი: მომთმენი, სანდო და ანტისტრესული გავლენით.\n\nურთიერთობები: ღრმა მიჯაჭვულობა და სითბო. აფასებს პატიოსნებასა და ერთგულებას.\n\nჯანმრთელობა: კომფორტის ზონიდან პერიოდული გამოსვლა ამაღლებს ტონში.\n\nსიძლიერეები: სტაბილურობა, გემოვნება, პრაქტიკულობა.\n\nსუსტი მხარეები: დატვირთული რუტინა და სიახლის შიში.\n\nრჩევა: დოზირებული ცვლილებები და მოძრაობა — ენერგიის განახლებისთვის.'
  },
  'ტყუპები': {
    male: '💬 ტყუპები მამაკაცი - კომუნიკაბელური და ინტელექტუალური. ყოველთვის მზადაა ახალი ინფორმაციისთვის და ძალიან კურიოზული. ძალიან კრეატიული და მრავალმხრივი - ყოველთვის აქვს ახალი იდეები. ზოგჯერ ძალიან ცვალებადი და ცვალებადი - ყოველთვის ეძებს ახალ გამოწვევებს. ძალიან სოციალური და მომხიბვლელი - ყოველთვის მზადაა ახალი კონტაქტებისთვის. ძალიან ინტელექტუალური და კურიოზული - ყოველთვის ეძებს ახალ ცოდნას. ძალიან კრეატიული და მრავალმხრივი - ყოველთვის აქვს ახალი იდეები.',
    female: '💬 ტყუპები ქალი - კომუნიკაბელური და ინტელექტუალური. ყოველთვის მზადაა ახალი ინფორმაციისთვის და ძალიან კურიოზული. ძალიან კრეატიული და მრავალმხრივი - ყოველთვის აქვს ახალი იდეები. ზოგჯერ ძალიან ცვალებადი და ცვალებადი - ყოველთვის ეძებს ახალ გამოწვევებს. ძალიან სოციალური და მომხიბვლელი - ყოველთვის მზადაა ახალი კონტაქტებისთვის. ძალიან ინტელექტუალური და კურიოზული - ყოველთვის ეძებს ახალ ცოდნას. ძალიან კრეატიული და მრავალმხრივი - ყოველთვის აქვს ახალი იდეები.'
  },
  'კირჩხიბი': {
    male: '🏠 კირჩხიბი მამაკაცი - ემოციური და მომზრუნველი. ძალიან ლოიალური ოჯახის მიმართ და ყოველთვის მზადაა დახმარებისთვის. ძალიან ინტუიციური და ემპათიური - ყოველთვის ხვდება სხვების ემოციებს. ზოგჯერ ძალიან მგრძნობიარე და ემოციური - ყოველთვის ფიქრობს სხვების ღირებულებებზე. ძალიან კრეატიული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის. ძალიან ლოიალურია ოჯახის მიმართ და ყოველთვის მზადაა დახმარებისთვის. ძალიან ინტუიციური და ემპათიური - ყოველთვის ხვდება სხვების ემოციებს.',
    female: '🏠 კირჩხიბი ქალი - ემოციური და მომზრუნველი. ძალიან ლოიალური ოჯახის მიმართ და ყოველთვის მზადაა დახმარებისთვის. ძალიან ინტუიციური და ემპათიური - ყოველთვის ხვდება სხვების ემოციებს. ზოგჯერ ძალიან მგრძნობიარე და ემოციური - ყოველთვის ფიქრობს სხვების ღირებულებებზე. ძალიან კრეატიული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის. ძალიან ლოიალურია ოჯახის მიმართ და ყოველთვის მზადაა დახმარებისთვის. ძალიან ინტუიციური და ემპათიური - ყოველთვის ხვდება სხვების ემოციებს.'
  },
  'ლომი': {
    male: '👑 ლომი მამაკაცი - ბუნებით ლიდერი და მეფე. ძალიან კრეატიული და ამბიციური - ყოველთვის მზადაა ახალი გამოწვევებისთვის. ძალიან გენეროზული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის. ძალიან ძლიერი ხასიათი და ლიდერობის უნარი - ყოველთვის მზადაა ახალი გამოწვევებისთვის. ძალიან კრეატიული და ამბიციური - ყოველთვის აქვს ახალი იდეები. ძალიან გენეროზული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის. ძალიან ძლიერი ხასიათი და ლიდერობის უნარი - ყოველთვის მზადაა ახალი გამოწვევებისთვის.',
    female: '👑 ლომი ქალი - ბუნებით ლიდერი და დედოფალი. ძალიან კრეატიული და ამბიციური - ყოველთვის მზადაა ახალი გამოწვევებისთვის. ძალიან გენეროზული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის. ძალიან ძლიერი ხასიათი და ლიდერობის უნარი - ყოველთვის მზადაა ახალი გამოწვევებისთვის. ძალიან კრეატიული და ამბიციური - ყოველთვის აქვს ახალი იდეები. ძალიან გენეროზული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის. ძალიან ძლიერი ხასიათი და ლიდერობის უნარი - ყოველთვის მზადაა ახალი გამოწვევებისთვის.'
  },
  'ქალწული': {
    male: '🔍 ქალწული მამაკაცი - პერფექციონისტი და ანალიტიკოსი. ძალიან ორგანიზებული და პრაქტიკული - ყოველთვის ფიქრობს დეტალებზე. ძალიან საიმედო და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ანალიტიკური და ლოგიკური - ყოველთვის ფიქრობს რაციონალურად. ძალიან ორგანიზებული და პრაქტიკული - ყოველთვის ფიქრობს დეტალებზე. ძალიან საიმედო და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ანალიტიკური და ლოგიკური - ყოველთვის ფიქრობს რაციონალურად.',
    female: '🔍 ქალწული ქალი - პერფექციონისტი და ანალიტიკოსი. ძალიან ორგანიზებული და პრაქტიკული - ყოველთვის ფიქრობს დეტალებზე. ძალიან საიმედო და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ანალიტიკური და ლოგიკური - ყოველთვის ფიქრობს რაციონალურად. ძალიან ორგანიზებული და პრაქტიკული - ყოველთვის ფიქრობს დეტალებზე. ძალიან საიმედო და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ანალიტიკური და ლოგიკური - ყოველთვის ფიქრობს რაციონალურად.'
  },
  'სასწორი': {
    male: '⚖️ სასწორი მამაკაცი - ჰარმონიული და დიპლომატიური. ძალიან კრეატიული და ესთეტიკური - ყოველთვის ფიქრობს ბალანსზე. ძალიან სოციალური და მომხიბვლელი - ყოველთვის მზადაა ახალი კონტაქტებისთვის. ძალიან დიპლომატიური და ჰარმონიული - ყოველთვის ფიქრობს ბალანსზე. ძალიან კრეატიული და ესთეტიკური - ყოველთვის ფიქრობს ბალანსზე. ძალიან სოციალური და მომხიბვლელი - ყოველთვის მზადაა ახალი კონტაქტებისთვის. ძალიან დიპლომატიური და ჰარმონიული - ყოველთვის ფიქრობს ბალანსზე.',
    female: '⚖️ სასწორი ქალი - ჰარმონიული და დიპლომატიური. ძალიან კრეატიული და ესთეტიკური - ყოველთვის ფიქრობს ბალანსზე. ძალიან სოციალური და მომხიბვლელი - ყოველთვის მზადაა ახალი კონტაქტებისთვის. ძალიან დიპლომატიური და ჰარმონიული - ყოველთვის ფიქრობს ბალანსზე. ძალიან კრეატიული და ესთეტიკური - ყოველთვის ფიქრობს ბალანსზე. ძალიან სოციალური და მომხიბვლელი - ყოველთვის მზადაა ახალი კონტაქტებისთვის. ძალიან დიპლომატიური და ჰარმონიული - ყოველთვის ფიქრობს ბალანსზე.'
  },
  'მორიელი': {
    male: '🦂 მორიელი მამაკაცი - ინტენსიური და მისტიკური. ძალიან ინტუიციური და ემოციური - ყოველთვის ფიქრობს ღრმა ღირებულებებზე. ძალიან ლოიალური და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ინტენსიური და მისტიკური - ყოველთვის ფიქრობს ღრმა ღირებულებებზე. ძალიან ინტუიციური და ემოციური - ყოველთვის ფიქრობს ღრმა ღირებულებებზე. ძალიან ლოიალური და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ინტენსიური და მისტიკური - ყოველთვის ფიქრობს ღრმა ღირებულებებზე.',
    female: '🦂 მორიელი ქალი - ინტენსიური და მისტიკური. ძალიან ინტუიციური და ემოციური - ყოველთვის ფიქრობს ღრმა ღირებულებებზე. ძალიან ლოიალური და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ინტენსიური და მისტიკური - ყოველთვის ფიქრობს ღრმა ღირებულებებზე. ძალიან ინტუიციური და ემოციური - ყოველთვის ფიქრობს ღრმა ღირებულებებზე. ძალიან ლოიალური და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ინტენსიური და მისტიკური - ყოველთვის ფიქრობს ღრმა ღირებულებებზე.'
  },
  'მშვილდოსანი': {
    male: '🏹 მშვილდოსანი მამაკაცი - ადვენტურისტი და ფილოსოფოსი. ძალიან ოპტიმისტური და ენერგიული - ყოველთვის მზადაა ახალი გამოწვევებისთვის. ძალიან გენეროზული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის. ძალიან ოპტიმისტური და ენერგიული - ყოველთვის მზადაა ახალი გამოწვევებისთვის. ძალიან გენეროზული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის. ძალიან ოპტიმისტური და ენერგიული - ყოველთვის მზადაა ახალი გამოწვევებისთვის. ძალიან გენეროზული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის.',
    female: '🏹 მშვილდოსანი ქალი - ადვენტურისტი და ფილოსოფოსი. ძალიან ოპტიმისტური და ენერგიული - ყოველთვის მზადაა ახალი გამოწვევებისთვის. ძალიან გენეროზული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის. ძალიან ოპტიმისტური და ენერგიული - ყოველთვის მზადაა ახალი გამოწვევებისთვის. ძალიან გენეროზული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის. ძალიან ოპტიმისტური და ენერგიული - ყოველთვის მზადაა ახალი გამოწვევებისთვის. ძალიან გენეროზული და მომზრუნველი - ყოველთვის მზადაა დახმარებისთვის.'
  },
  'თხის რქა': {
    male: '🐐 თხის რქა მამაკაცი - ამბიციური და პრაქტიკული. ძალიან ორგანიზებული და მიზანდასახული - ყოველთვის ფიქრობს კარიერაზე. ძალიან საიმედო და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ამბიციური და პრაქტიკული - ყოველთვის ფიქრობს კარიერაზე. ძალიან ორგანიზებული და მიზანდასახული - ყოველთვის ფიქრობს კარიერაზე. ძალიან საიმედო და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ამბიციური და პრაქტიკული - ყოველთვის ფიქრობს კარიერაზე.',
    female: '🐐 თხის რქა ქალი - ამბიციური და პრაქტიკული. ძალიან ორგანიზებული და მიზანდასახული - ყოველთვის ფიქრობს კარიერაზე. ძალიან საიმედო და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ამბიციური და პრაქტიკული - ყოველთვის ფიქრობს კარიერაზე. ძალიან ორგანიზებული და მიზანდასახული - ყოველთვის ფიქრობს კარიერაზე. ძალიან საიმედო და მომთმენი - ყოველთვის ასრულებს თავის ვალდებულებებს. ძალიან ამბიციური და პრაქტიკული - ყოველთვის ფიქრობს კარიერაზე.'
  },
  'მერწყული': {
    male: '🌊 მერწყული მამაკაცი - ინოვატორი და ორიგინალური. ძალიან კრეატიული და ინტელექტუალური - ყოველთვის მზადაა ახალი იდეებისთვის. ძალიან სოციალური და მომხიბვლელი - ყოველთვის მზადაა ახალი კონტაქტებისთვის. ძალიან ინოვატორი და ორიგინალური - ყოველთვის მზადაა ახალი იდეებისთვის. ძალიან კრეატიული და ინტელექტუალური - ყოველთვის მზადაა ახალი იდეებისთვის. ძალიან სოციალური და მომხიბვლელი - ყოველთვის მზადაა ახალი კონტაქტებისთვის. ძალიან ინოვატორი და ორიგინალური - ყოველთვის მზადაა ახალი იდეებისთვის.',
    female: '🌊 მერწყული ქალი - ინოვატორი და ორიგინალური. ძალიან კრეატიული და ინტელექტუალური - ყოველთვის მზადაა ახალი იდეებისთვის. ძალიან სოციალური და მომხიბვლელი - ყოველთვის მზადაა ახალი კონტაქტებისთვის. ძალიან ინოვატორი და ორიგინალური - ყოველთვის მზადაა ახალი იდეებისთვის. ძალიან კრეატიული და ინტელექტუალური - ყოველთვის მზადაა ახალი იდეებისთვის. ძალიან სოციალური და მომხიბვლელი - ყოველთვის მზადაა ახალი კონტაქტებისთვის. ძალიან ინოვატორი და ორიგინალური - ყოველთვის მზადაა ახალი იდეებისთვის.'
  },
  'თევზები': {
    male: '🐠 თევზები მამაკაცი - კრეატიული და ინტუიციური. ძალიან ემპათიური და მომზრუნველი - ყოველთვის ფიქრობს ემოციებზე. ძალიან რომანტიკული და მგრძნობიარე - ყოველთვის ფიქრობს სხვების ღირებულებებზე. ძალიან კრეატიული და ინტუიციური - ყოველთვის მზადაა ახალი იდეებისთვის. ძალიან ემპათიური და მომზრუნველი - ყოველთვის ფიქრობს ემოციებზე. ძალიან რომანტიკული და მგრძნობიარე - ყოველთვის ფიქრობს სხვების ღირებულებებზე. ძალიან კრეატიული და ინტუიციური - ყოველთვის მზადაა ახალი იდეებისთვის.',
    female: '🐠 თევზები ქალი - კრეატიული და ინტუიციური. ძალიან ემპათიური და მომზრუნველი - ყოველთვის ფიქრობს ემოციებზე. ძალიან რომანტიკული და მგრძნობიარე - ყოველთვის ფიქრობს სხვების ღირებულებებზე. ძალიან კრეატიული და ინტუიციური - ყოველთვის მზადაა ახალი იდეებისთვის. ძალიან ემპათიური და მომზრუნველი - ყოველთვის ფიქრობს ემოციებზე. ძალიან რომანტიკული და მგრძნობიარე - ყოველთვის ფიქრობს სხვების ღირებულებებზე. ძალიან კრეატიული და ინტუიციური - ყოველთვის მზადაა ახალი იდეებისთვის.'
  }
};

// შეწყობების მატრიცა
const compatibilityMatrix = {
  'ვერძი': ['ლომი', 'მშვილდოსანი', 'ტყუპები', 'მერწყული'],
  'კურო': ['ქალწული', 'თხის რქა', 'კირჩხიბი', 'თევზები'],
  'ტყუპები': ['სასწორი', 'მერწყული', 'ვერძი', 'ლომი'],
  'კირჩხიბი': ['მორიელი', 'თევზები', 'კურო', 'ქალწული'],
  'ლომი': ['ვერძი', 'მშვილდოსანი', 'ტყუპები', 'სასწორი'],
  'ქალწული': ['კურო', 'თხის რქა', 'კირჩხიბი', 'მორიელი'],
  'სასწორი': ['ტყუპები', 'მერწყული', 'ლომი', 'მშვილდოსანი'],
  'მორიელი': ['კირჩხიბი', 'თევზები', 'ქალწული', 'თხის რქა'],
  'მშვილდოსანი': ['ვერძი', 'ლომი', 'სასწორი', 'მერწყული'],
  'თხის რქა': ['კურო', 'ქალწული', 'მორიელი', 'თევზები'],
  'მერწყული': ['ტყუპები', 'სასწორი', 'ვერძი', 'მშვილდოსანი'],
  'თევზები': ['კირჩხიბი', 'მორიელი', 'კურო', 'თხის რქა']
};

export default function HoroscopePage() {
  const [selectedSign, setSelectedSign] = useState<string>('');
  const [selectedSign2, setSelectedSign2] = useState<string>('');
  const [birthDate, setBirthDate] = useState('');
  const [birthTime, setBirthTime] = useState('');
  const [activeTab, setActiveTab] = useState<'daily' | 'compatibility' | 'chart' | 'general'>('daily');
  const [showModal, setShowModal] = useState(false);
  const [modalSign, setModalSign] = useState<string>('');
  const [selectedGender, setSelectedGender] = useState<'male' | 'female' | ''>('');
  const [modalType, setModalType] = useState<'daily' | 'general'>('daily');
  const [horoscopeCache, setHoroscopeCache] = useState<{[key: string]: string}>({});
  const [loadingHoroscope, setLoadingHoroscope] = useState<string | null>(null);

  const getElement = (signName: string): string | undefined => {
    return zodiacSigns.find(z => z.name === signName)?.element;
  };

  const getCompatibilityDetail = (
    sign1: string,
    sign2: string
  ): { score: number; label: string; explanation: string } | null => {
    if (!sign1 || !sign2) return null;
    const e1 = getElement(sign1);
    const e2 = getElement(sign2);
    if (!e1 || !e2) return null;

    const same = e1 === e2;
    const pair = `${e1}-${e2}`;
    let score = 60;
    let label = 'საშუალო შეწყობა';
    let explanation = 'არსებობს პოტენციალი, თუმცა საჭიროა გაცნობიერებული მუშაობა განსხვავებებზე.';

    if (same) {
      score = 90;
      label = 'ძალიან კარგი შეწყობა';
      explanation = 'ერთი და იმავე ელემენტი ქმნის ბუნებრივ სინქრონიას, ტემპსა და ღირებულებათა საერთო ხედვას.';
    } else if (pair === 'ცეცხლი-ჰაერი' || pair === 'ჰაერი-ცეცხლი') {
      score = 85;
      label = 'ძალიან კარგი შეწყობა';
      explanation = 'ჰაერი კვებავს ცეცხლს იდეებით, ცეცხლი აძლევს იმპულსს — ენერგიული და ინსპირაციული კავშირი.';
    } else if (pair === 'მიწა-წყალი' || pair === 'წყალი-მიწა') {
      score = 82;
      label = 'კარგი შეწყობა';
      explanation = 'წყალი ემოციურ სიღრმეს აძლევს მიწას, მიწა — სტაბილურ დასაყრდენს წყალს.';
    } else if (pair === 'ცეცხლი-წყალი' || pair === 'წყალი-ცეცხლი') {
      score = 65;
      label = 'დაინამიკა და ვნება';
      explanation = 'ვნებიანი, მაგრამ ტემპერატურის კონტროლი მნიშვნელოვანია, რათა ემოციამ კონფლიქტში არ გადაიზარდოს.';
    } else if (pair === 'ჰაერი-მიწა' || pair === 'მიწა-ჰაერი') {
      score = 62;
      label = 'საშუალო შეწყობა';
      explanation = 'იდეები და რეალიზმი — სწორი როლების განაწილებით შესაძლებელია ეფექტური პარტნიორობა.';
    } else if (pair === 'ჰაერი-წყალი' || pair === 'წყალი-ჰაერი') {
      score = 58;
      label = 'საშუალოზე დაბალი';
      explanation = 'გონება და ემოცია განსხვავებულ ენაზე ლაპარაკობენ — საჭიროა ემპათია და სიღრმის მოთმინება.';
    } else if (pair === 'ცეცხლი-მიწა' || pair === 'მიწა-ცეცხლი') {
      score = 60;
      label = 'საშუალო';
      explanation = 'ენერგია და სტაბილურობა — თუ მიზნები თანხვედრილია, კავშირი პროდუქტიული ხდება.';
    }

    // მცირე კორექცია “საუფლებო” შეწყობის მიხედვით
    const listed = compatibilityMatrix[sign1 as keyof typeof compatibilityMatrix]?.includes(sign2);
    if (listed) score = Math.max(score, 80);

    return { score, label, explanation };
  };

  const fetchHoroscope = async (sign: string) => {
    const today = new Date();
    const dateKey = `${today.getFullYear()}-${today.getMonth()}-${today.getDate()}`;
    const cacheKey = `${sign}-${dateKey}`;

    if (horoscopeCache[cacheKey]) return horoscopeCache[cacheKey];

    setLoadingHoroscope(sign);
    try {
      const res = await fetch(`/api/horoscope?sign=${encodeURIComponent(sign)}&day=today`, { cache: 'no-store' });
      if (res.ok) {
        const data = await res.json();
        const text = data?.horoscope || 'ჰოროსკოპი ვერ მოიძებნა.';
        setHoroscopeCache(prev => ({ ...prev, [cacheKey]: text }));
        setLoadingHoroscope(null);
        return text;
      }
    } catch (e) {
      // ignore and fallback
    }

    // Final fallback: local rotation
    const dayOfYear = Math.floor((today.getTime() - new Date(today.getFullYear(), 0, 0).getTime()) / (1000 * 60 * 60 * 24));
    const horoscopes = horoscopeBase[sign as keyof typeof horoscopeBase];
    const text = horoscopes ? horoscopes[dayOfYear % horoscopes.length] : 'ჰოროსკოპი ვერ მოიძებნა.';
    setHoroscopeCache(prev => ({ ...prev, [cacheKey]: text }));
    setLoadingHoroscope(null);
    return text;
  };

  const openModal = (sign: string, type: 'daily' | 'general') => {
    setModalSign(sign);
    setModalType(type);
    setSelectedGender('');
    setShowModal(true);
    
    // თუ daily ჰოროსკოპია, ვჩაიტვირთავთ API-დან
    if (type === 'daily') {
      fetchHoroscope(sign);
    }
  };

  const closeModal = () => {
    setShowModal(false);
    setModalSign('');
    setSelectedGender('');
    setModalType('daily');
  };

  const generateBirthChart = () => {
    if (!birthDate || !birthTime) return null;
    
    // მარტივი ბირთვის რუკის გენერაცია
    const date = new Date(birthDate);
    const month = date.getMonth() + 1;
    const day = date.getDate();
    
    let sign = '';
    if ((month === 3 && day >= 21) || (month === 4 && day <= 19)) sign = 'ვერძი';
    else if ((month === 4 && day >= 20) || (month === 5 && day <= 20)) sign = 'კურო';
    else if ((month === 5 && day >= 21) || (month === 6 && day <= 20)) sign = 'ტყუპები';
    else if ((month === 6 && day >= 21) || (month === 7 && day <= 22)) sign = 'კირჩხიბი';
    else if ((month === 7 && day >= 23) || (month === 8 && day <= 22)) sign = 'ლომი';
    else if ((month === 8 && day >= 23) || (month === 9 && day <= 22)) sign = 'ქალწული';
    else if ((month === 9 && day >= 23) || (month === 10 && day <= 22)) sign = 'სასწორი';
    else if ((month === 10 && day >= 23) || (month === 11 && day <= 21)) sign = 'მორიელი';
    else if ((month === 11 && day >= 22) || (month === 12 && day <= 21)) sign = 'მშვილდოსანი';
    else if ((month === 12 && day >= 22) || (month === 1 && day <= 19)) sign = 'თხის რქა';
    else if ((month === 1 && day >= 20) || (month === 2 && day <= 18)) sign = 'მერწყული';
    else sign = 'თევზები';
    
    return {
      sign,
      element: zodiacSigns.find(z => z.name === sign)?.element,
      emoji: zodiacSigns.find(z => z.name === sign)?.emoji
    };
  };

  const birthChart = generateBirthChart();

  // useEffect რომ birth chart-ის შეცვლისას ჰოროსკოპი ჩაიტვირთოს
  React.useEffect(() => {
    if (birthChart && birthChart.sign) {
      fetchHoroscope(birthChart.sign);
    }
  }, [birthChart]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white">
      {/* Header */}
      <div className="container mx-auto px-4 py-8">
        <motion.div
          initial={{ opacity: 0, y: -20 }}
          animate={{ opacity: 1, y: 0 }}
          className="text-center mb-12"
        >
          <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent">
            ✨ ჰოროსკოპი ✨
          </h1>
          <p className="text-xl text-gray-300 max-w-2xl mx-auto">
            აღმოაჩინე ვარსკვლავების საიდუმლოებები და გაიგე რა გელოდება!
          </p>
        </motion.div>

        {/* Navigation Tabs */}
        <div className="flex justify-center mb-8">
          <div className="bg-white/10 backdrop-blur-sm rounded-full p-2 flex gap-2 flex-wrap">
            {[
              { id: 'daily', label: 'ყოველდღიური', icon: '🌟' },
              { id: 'general', label: 'ზოგადი ინფო', icon: '📋' },
              { id: 'compatibility', label: 'შეწყობა', icon: '💕' },
              { id: 'chart', label: 'პირადი რუკა', icon: '🗺️' }
            ].map((tab) => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id as any)}
                className={`px-6 py-3 rounded-full transition-all duration-300 ${
                  activeTab === tab.id
                    ? 'bg-gradient-to-r from-pink-500 to-purple-500 text-white shadow-lg'
                    : 'text-gray-300 hover:text-white hover:bg-white/20'
                }`}
              >
                <span className="mr-2">{tab.icon}</span>
                {tab.label}
              </button>
            ))}
          </div>
        </div>

        {/* Daily Horoscope Tab */}
        {activeTab === 'daily' && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="max-w-4xl mx-auto"
          >
            <h2 className="text-3xl font-bold text-center mb-8 text-pink-300">
              🌟 ყოველდღიური ჰოროსკოპი
            </h2>
            
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
              {zodiacSigns.map((sign, index) => (
                <motion.div
                  key={sign.name}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: index * 0.1 }}
                  className="bg-white/10 backdrop-blur-sm rounded-2xl p-6 hover:bg-white/20 transition-all duration-300 cursor-pointer border border-white/20 group"
                  onClick={() => openModal(sign.name, 'daily')}
                >
                  <div className="text-center">
                    <div className="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">{sign.emoji}</div>
                    <h3 className="text-xl font-bold mb-2">{sign.name}</h3>
                    <p className="text-sm text-gray-300 mb-2">{sign.dates}</p>
                    <p className="text-sm text-purple-300">{sign.element}</p>
                    <div className="mt-3 text-xs text-pink-300 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                      ყოველდღიური ჰოროსკოპი
                    </div>
                  </div>
                </motion.div>
              ))}
            </div>

          </motion.div>
        )}

        {/* General Information Tab */}
        {activeTab === 'general' && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="max-w-4xl mx-auto"
          >
            <h2 className="text-3xl font-bold text-center mb-8 text-pink-300">
              📋 ზოგადი ინფორმაცია
            </h2>
            
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
              {zodiacSigns.map((sign, index) => (
                <motion.div
                  key={sign.name}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: index * 0.1 }}
                  className="bg-white/10 backdrop-blur-sm rounded-2xl p-6 hover:bg-white/20 transition-all duration-300 cursor-pointer border border-white/20 group"
                  onClick={() => openModal(sign.name, 'general')}
                >
                  <div className="text-center">
                    <div className="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">{sign.emoji}</div>
                    <h3 className="text-xl font-bold mb-2">{sign.name}</h3>
                    <p className="text-sm text-gray-300 mb-2">{sign.dates}</p>
                    <p className="text-sm text-purple-300">{sign.element}</p>
                    <div className="mt-3 text-xs text-pink-300 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                      ზოგადი აღწერა
                    </div>
                  </div>
                </motion.div>
              ))}
            </div>

          </motion.div>
        )}

        {/* Compatibility Tab */}
        {activeTab === 'compatibility' && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="max-w-4xl mx-auto"
          >
            <h2 className="text-3xl font-bold text-center mb-8 text-pink-300">
              💕 ზოდიაქოს შეწყობა
            </h2>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
              <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-6">
                <h3 className="text-xl font-bold mb-4 text-center">პირველი ნიშანი (ქალი)</h3>
                <div className="grid grid-cols-2 gap-3">
                  {zodiacSigns.map((sign) => (
                    <button
                      key={sign.name}
                      onClick={() => setSelectedSign(sign.name)}
                      className={`p-3 rounded-xl transition-all duration-300 ${
                        selectedSign === sign.name
                          ? 'bg-gradient-to-r from-pink-500 to-purple-500 text-white'
                          : 'bg-white/10 hover:bg-white/20 text-gray-300'
                      }`}
                    >
                      <div className="text-2xl mb-1">{sign.emoji}</div>
                      <div className="text-sm font-medium">{sign.name}</div>
                    </button>
                  ))}
                </div>
              </div>

              <div className="bg-white/10 backdrop-blur-sm rounded-ილ p-6">
                <h3 className="text-xl font-bold mb-4 text-center">მეორე ნიშანი (მამაკაცი)</h3>
                <div className="grid grid-cols-2 gap-3">
                  {zodiacSigns.map((sign) => (
                    <button
                      key={sign.name}
                      onClick={() => setSelectedSign2(sign.name)}
                      className={`p-3 rounded-xl transition-all duration-300 ${
                        selectedSign2 === sign.name
                          ? 'bg-gradient-to-r from-pink-500 to-purple-500 text-white'
                          : 'bg-white/10 hover:bg-white/20 text-gray-300'
                      }`}
                    >
                      <div className="text-2xl mb-1">{sign.emoji}</div>
                      <div className="text-sm font-medium">{sign.name}</div>
                    </button>
                  ))}
                </div>
              </div>
            </div>

            {selectedSign && selectedSign2 && (
              <motion.div
                initial={{ opacity: 0, scale: 0.9 }}
                animate={{ opacity: 1, scale: 1 }}
                className="bg-gradient-to-r from-pink-500/20 to-purple-500/20 backdrop-blur-sm rounded-2xl p-8 border border-white/20 text-center"
              >
                <div className="flex justify-center items-center gap-4 mb-6">
                  <div className="text-4xl">
                    {zodiacSigns.find(s => s.name === selectedSign)?.emoji}
                  </div>
                  <div className="text-2xl">💕</div>
                  <div className="text-4xl">
                    {zodiacSigns.find(s => s.name === selectedSign2)?.emoji}
                  </div>
                </div>
                <h3 className="text-2xl font-bold mb-4">
                  {selectedSign} (ქ) & {selectedSign2} (მ)
                </h3>
                {(() => {
                  const detail = getCompatibilityDetail(selectedSign, selectedSign2);
                  if (!detail) return null;
                  return (
                    <div>
                      <div className="w-full h-3 rounded-full bg-white/10 overflow-hidden mb-2">
                        <div
                          className="h-3 bg-pink-500"
                          style={{ width: `${detail.score}%` }}
                        />
                      </div>
                      <div className="text-sm text-gray-300 mb-3">{detail.score}% • {detail.label}</div>
                      <p className="text-xl">{detail.explanation}</p>
                    </div>
                  );
                })()}
              </motion.div>
            )}
          </motion.div>
        )}

        {/* Birth Chart Tab */}
        {activeTab === 'chart' && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="max-w-2xl mx-auto"
          >
            <h2 className="text-3xl font-bold text-center mb-8 text-pink-300">
              🗺️ პირადი ბირთვის რუკა
            </h2>
            
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-8 mb-8">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label className="block text-lg font-medium mb-3">დაბადების თარიღი</label>
                  <input
                    type="date"
                    value={birthDate}
                    onChange={(e) => setBirthDate(e.target.value)}
                    className="w-full p-4 rounded-xl bg-white/20 border border-white/30 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-500"
                  />
                </div>
                <div>
                  <label className="block text-lg font-medium mb-3">დაბადების საათი</label>
                  <input
                    type="time"
                    value={birthTime}
                    onChange={(e) => setBirthTime(e.target.value)}
                    className="w-full p-4 rounded-xl bg-white/20 border border-white/30 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-500"
                  />
                </div>
              </div>
            </div>

            {birthChart && (
              <motion.div
                initial={{ opacity: 0, scale: 0.9 }}
                animate={{ opacity: 1, scale: 1 }}
                className="bg-gradient-to-r from-pink-500/20 to-purple-500/20 backdrop-blur-sm rounded-2xl p-8 border border-white/20 text-center"
              >
                <div className="text-6xl mb-6">{birthChart.emoji}</div>
                <h3 className="text-3xl font-bold mb-4">შენი ზოდიაქოს ნიშანი</h3>
                <h4 className="text-2xl mb-4 text-pink-300">{birthChart.sign}</h4>
                <p className="text-lg mb-6">ელემენტი: <span className="text-purple-300 font-bold">{birthChart.element}</span></p>
                
                <div className="bg-white/10 rounded-xl p-6">
                  <h5 className="text-xl font-bold mb-4">შენი პირადი ჰოროსკოპი</h5>
                  <div className="text-lg leading-relaxed">
                    {loadingHoroscope === birthChart.sign ? (
                      <div className="flex items-center justify-center py-8">
                        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"></div>
                        <span className="ml-3 text-purple-300">ჰოროსკოპი ჩაიტვირთება...</span>
                      </div>
                    ) : (
                      <p>{horoscopeCache[`${birthChart.sign}-${new Date().getFullYear()}-${new Date().getMonth()}-${new Date().getDate()}`] || 'ჰოროსკოპი ვერ მოიძებნა.'}</p>
                    )}
                  </div>
                </div>
              </motion.div>
            )}
          </motion.div>
        )}

        {/* Modal */}
        {showModal && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
            onClick={closeModal}
          >
            <motion.div
              initial={{ opacity: 0, scale: 0.9, y: 20 }}
              animate={{ opacity: 1, scale: 1, y: 0 }}
              exit={{ opacity: 0, scale: 0.9, y: 20 }}
              className="bg-gradient-to-br from-purple-900 to-blue-900 rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-white/20"
              onClick={(e) => e.stopPropagation()}
            >
              <div className="flex justify-between items-center mb-6">
                <h3 className="text-2xl font-bold text-pink-300">
                  {modalSign} - {modalType === 'daily' ? 'ყოველდღიური ჰოროსკოპი' : 'ზოგადი აღწერა'}
                </h3>
                <button
                  onClick={closeModal}
                  className="text-white/70 hover:text-white text-2xl transition-colors duration-300"
                >
                  ✕
                </button>
              </div>

              <div className="text-center mb-6">
                <div className="text-6xl mb-4">
                  {zodiacSigns.find(s => s.name === modalSign)?.emoji}
                </div>
                <h4 className="text-xl font-bold mb-2">{modalSign}</h4>
                <p className="text-gray-300">
                  {zodiacSigns.find(s => s.name === modalSign)?.dates} • {zodiacSigns.find(s => s.name === modalSign)?.element}
                </p>
                <p className="text-gray-300 mt-1 text-sm">
                  {signMeta[modalSign as keyof typeof signMeta]?.modality} • {signMeta[modalSign as keyof typeof signMeta]?.ruler}
                </p>
              </div>

              {modalType === 'daily' ? (
                <div className="bg-white/10 rounded-xl p-6">
                  <h5 className="text-lg font-bold mb-4 text-purple-300">
                    🌟 ყოველდღიური ჰოროსკოპი
                  </h5>
                  <div className="text-lg leading-relaxed">
                    {loadingHoroscope === modalSign ? (
                      <div className="flex items-center justify-center py-8">
                        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"></div>
                        <span className="ml-3 text-purple-300">ჰოროსკოპი ჩაიტვირთება...</span>
                      </div>
                    ) : (
                      <p>{horoscopeCache[`${modalSign}-${new Date().getFullYear()}-${new Date().getMonth()}-${new Date().getDate()}`] || 'ჰოროსკოპი ვერ მოიძებნა.'}</p>
                    )}
                  </div>
                  <div className="flex justify-center mt-6">
                    <button
                      onClick={closeModal}
                      className="px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-500 rounded-xl hover:from-pink-600 hover:to-purple-600 transition-all duration-300 text-white font-bold"
                    >
                      ✅ დახურვა
                    </button>
                  </div>
                </div>
              ) : (
                <>
                  {!selectedGender ? (
                    <div className="text-center">
                      <p className="text-lg mb-6 text-gray-300">აირჩიეთ სქესი დეტალური აღწერისთვის:</p>
                      <div className="flex gap-4 justify-center">
                        <button
                          onClick={() => setSelectedGender('male')}
                          className="px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl hover:from-blue-600 hover:to-purple-600 transition-all duration-300 text-white font-bold"
                        >
                          👨 მამაკაცი
                        </button>
                        <button
                          onClick={() => setSelectedGender('female')}
                          className="px-8 py-4 bg-gradient-to-r from-pink-500 to-purple-500 rounded-xl hover:from-pink-600 hover:to-purple-600 transition-all duration-300 text-white font-bold"
                        >
                          👩 ქალი
                        </button>
                      </div>
                    </div>
                  ) : (
                    <div className="space-y-6">
                      <div className="bg-white/10 rounded-xl p-6">
                        <h5 className="text-lg font-bold mb-4 text-pink-300">
                          {selectedGender === 'male' ? '👨' : '👩'} {modalSign} {selectedGender === 'male' ? 'მამაკაცი' : 'ქალი'}
                        </h5>
                        {signDescriptions[modalSign as keyof typeof signDescriptions]?.[selectedGender]
                          .split('\n\n')
                          .map((para: string, idx: number) => {
                            const parts = para.split(/:\\s*/);
                            if (parts.length > 1) {
                              const label = parts.shift();
                              const rest = parts.join(': ');
                              return (
                                <p key={idx} className="text-lg leading-relaxed mb-4 last:mb-0">
                                  <span className="font-bold">{label}:</span> {rest}
                                </p>
                              );
                            }
                            return (
                              <p key={idx} className="text-lg leading-relaxed mb-4 last:mb-0">{para}</p>
                            );
                          })}
                      </div>

                      <div className="flex gap-4 justify-center">
                        <button
                          onClick={() => setSelectedGender('')}
                          className="px-6 py-3 bg-white/20 rounded-xl hover:bg-white/30 transition-all duration-300 text-white"
                        >
                          🔄 სხვა სქესი
                        </button>
                        <button
                          onClick={closeModal}
                          className="px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-500 rounded-xl hover:from-pink-600 hover:to-purple-600 transition-all duration-300 text-white font-bold"
                        >
                          ✅ დახურვა
                        </button>
                      </div>
                    </div>
                  )}
                </>
              )}
            </motion.div>
          </motion.div>
        )}
      </div>
    </div>
  );
}
